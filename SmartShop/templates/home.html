{% extends 'base.html' %}

{% block content %}
<style>
.platform-card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    transition: transform 0.3s;
}

.platform-card:hover {
    transform: scale(1.05);
}

.amazon-card {
    border: 3px solid #FF9900;
}

.ebay-card {
    border: 3px solid #E53238;
}

.battle-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    transition: all 0.3s;
}

.battle-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.2);
}

.battle-header {
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    display: flex;
    justify-content: space-between;
    z-index: 10;
}

.battle-img {
    width: 100%;
    height: 250px;
    object-fit: cover;
}

.battle-body {
    padding: 20px;
}

.battle-title {
    font-weight: 600;
    min-height: 60px;
}

.price-battle {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 15px;
}

.price-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.platform-icon {
    font-size: 2rem;
}

.vs-divider {
    text-align: center;
    font-weight: 900;
    color: #dc3545;
    font-size: 1.2rem;
    margin: 10px 0;
}

.winner-badge {
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    font-weight: 600;
}

.amazon-winner {
    background: linear-gradient(135deg, #FF9900 0%, #ff7700 100%);
    color: white;
}

.ebay-winner {
    background: linear-gradient(135deg, #E53238 0%, #c41e24 100%);
    color: white;
}

.mini-battle-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    transition: all 0.3s;
}

.mini-battle-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
}

.mini-battle-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
}
</style>

<!-- Hero Battle Section -->
<section class="hero">
    <div class="container text-center">
        <h1 class="display-3 fw-bold mb-3">‚öîÔ∏è Amazon vs eBay</h1>
        <p class="lead mb-4">La bataille des prix commence ici ! Trouvez le meilleur deal</p>
        <div class="row justify-content-center mt-5">
            <div class="col-md-5">
                <div class="platform-card amazon-card">
                    <h2>üõí Amazon</h2>
                    <p class="display-4 fw-bold">{{ amazon_wins }}</p>
                    <p>Victoires</p>
                </div>
            </div>
            <div class="col-md-2 d-flex align-items-center justify-content-center">
                <span class="display-3">‚ö°</span>
            </div>
            <div class="col-md-5">
                <div class="platform-card ebay-card">
                    <h2>üè™ eBay</h2>
                    <p class="display-4 fw-bold">{{ total_products|add:"-"|add:amazon_wins }}</p>
                    <p>Victoires</p>
                </div>
            </div>
        </div>
        <a href="#battles" class="btn btn-light btn-lg mt-4">Voir les batailles</a>
    </div>
</section>

<!-- Featured Battles -->
<section id="battles" class="container mb-5">
    <h2 class="section-title">üî• Batailles en Vedette</h2>
    <div class="row g-4">
        {% for product in featured_products %}
        <div class="col-md-6 col-lg-4">
            <div class="battle-card">
                <div class="battle-header">
                    <span class="badge bg-danger">BATAILLE</span>
                    <a href="{% url 'products:category' product.category.slug %}" class="category-badge">
                        {{ product.category.name }}
                    </a>
                </div>
                <img src="{{ product.image.url }}" loading="lazy" class="battle-img" alt="{{ product.title }}">
                <div class="battle-body">
                    <h5 class="battle-title">{{ product.title }}</h5>
                    
                    <div class="price-battle mt-3">
                        <div class="price-item amazon">
                            <div class="platform-icon">üõí</div>
                            <div>
                                <small>Amazon</small>
                                <div class="price">{{ product.amazon_price }} ‚Ç¨</div>
                                {% if product.amazon_shipping > 0 %}
                                <small class="text-muted">+{{ product.amazon_shipping }}‚Ç¨ livraison</small>
                                {% else %}
                                <small class="text-success">Livraison gratuite</small>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="vs-divider">VS</div>
                        
                        <div class="price-item ebay">
                            <div class="platform-icon">üè™</div>
                            <div>
                                <small>eBay</small>
                                <div class="price">{{ product.ebay_price }} ‚Ç¨</div>
                                {% if product.ebay_shipping > 0 %}
                                <small class="text-muted">+{{ product.ebay_shipping }}‚Ç¨ livraison</small>
                                {% else %}
                                <small class="text-success">Livraison gratuite</small>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    {% if product.amazon_price and product.ebay_price %}
                        {% if product.amazon_price < product.ebay_price %}
                        <div class="winner-badge amazon-winner mt-3">
                            üèÜ Amazon gagne
                        </div>
                        {% else %}
                        <div class="winner-badge ebay-winner mt-3">
                            üèÜ eBay gagne
                        </div>
                        {% endif %}
                    {% endif %}
                    
                    <a href="{% url 'products:product_detail' product.slug %}" class="btn btn-primary w-100 mt-3">
                        Voir le d√©tail du combat
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p class="lead text-muted">Aucun produit en vedette. Ajoutez des produits depuis l'admin !</p>
            <a href="/admin/" class="btn btn-primary">Aller √† l'admin</a>
        </div>
        {% endfor %}
    </div>
</section>

<!-- Latest Battles -->
<section class="container mb-5">
    <h2 class="section-title">‚ö° Derni√®res Batailles</h2>
    <div class="row g-4">
        {% for product in latest_products %}
        <div class="col-md-3">
            <div class="mini-battle-card">
                <img src="{{ product.image.url }}" alt="{{ product.title }}">
                <div class="p-3">
                    <h6 class="mb-2">{{ product.title|truncatewords:6 }}</h6>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="small">
                            {% if product.amazon_price and product.ebay_price %}
                                {% if product.amazon_price < product.ebay_price %}
                                <span class="badge bg-warning">üõí Amazon</span>
                                {% else %}
                                <span class="badge bg-info">üè™ eBay</span>
                                {% endif %}
                            {% endif %}
                        </span>
                        <a href="{% url 'products:product_detail' product.slug %}" class="btn btn-sm btn-primary">Voir</a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
            <p class="text-muted">Aucun produit disponible.</p>
        </div>
        {% endfor %}
    </div>
</section>

{% block extra_js %}
<script>
    // Animation des compteurs
    function animateCounter(element, target) {
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                element.textContent = target;
                clearInterval(timer);
            } else {
                element.textContent = Math.floor(current);
            }
        }, 30);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const amazonCounter = document.querySelector('.amazon-card .display-4');
        const ebayCounter = document.querySelector('.ebay-card .display-4');
        
        if (amazonCounter) {
            const amazonWins = parseInt(amazonCounter.textContent);
            amazonCounter.textContent = '0';
            setTimeout(() => animateCounter(amazonCounter, amazonWins), 500);
        }
        
        if (ebayCounter) {
            const ebayWins = parseInt(ebayCounter.textContent);
            ebayCounter.textContent = '0';
            setTimeout(() => animateCounter(ebayCounter, ebayWins), 700);
        }
    });
</script>
{% endblock %}
{% endblock %}